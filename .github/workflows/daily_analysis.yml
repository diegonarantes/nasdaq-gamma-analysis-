name: An√°lise Di√°ria de GEX

on:
  # Executar diariamente √†s 13:00 UTC (08:00 AM ET / 09:00 AM BRT)
  # Isso √© antes da abertura do mercado americano (9:30 AM ET)
  schedule:
    - cron: '0 13 * * 1-5'  # Segunda a Sexta
  
  # Permitir execu√ß√£o manual
  workflow_dispatch:

jobs:
  collect-and-process:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout do reposit√≥rio
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Instalar depend√™ncias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Coletar dados de op√ß√µes
        env:
          ALPHA_VANTAGE_API_KEY: ${{ secrets.ALPHA_VANTAGE_API_KEY }}
          TARGET_SYMBOL: QQQ
        run: |
          python src/collect_data.py
      
      - name: Processar dados e calcular GEX
        env:
          TARGET_SYMBOL: QQQ
        run: |
          python src/process_data.py
      
      - name: Gerar gr√°fico de visualiza√ß√£o
        env:
          TARGET_SYMBOL: QQQ
        run: |
          python src/generate_chart.py
      
      - name: Atualizar README
        env:
          TARGET_SYMBOL: QQQ
        run: |
          python src/update_readme.py
      
      - name: Commit e push das mudan√ßas
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add data/ charts/ README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "üìä Atualiza√ß√£o autom√°tica - $(date +'%Y-%m-%d')" && git push)
